<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />

    <meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport" />
    <meta name="color-scheme" content="light" />
    <meta name="theme-color" content="#ffffff" />
    <title>Story Mode</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    
    <link rel="stylesheet" href="/static/css/story.css">
</head>

<body>
    <header class="site-header">
        <div class="header__inner">
            <button class="back-btn" id="backBtn">
                <span class="material-symbols-outlined">arrow_back</span>
            </button>

            <span class="header-title" id="headerTitle">Stories</span>
            <div class="story-list-header">
                <button class="create-story-btn" id="createStoryBtn">+</button>
            </div>

            <div class="progress-container" id="progressContainer" style="display: none;">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <span class="progress-text" id="progressText" style="display: none;">0/0</span>
            <button class="audio-toggle-btn" id="refreshTranslationsBtn" type="button" style="display:none;"
                title="Refresh translations">
                <span class="material-symbols-outlined audio-toggle-btn-icon">refresh</span>
            </button>
            <button class="audio-toggle-btn" id="audioToggleBtn" type="button" style="display:none;">
                <span class="material-symbols-outlined audio-toggle-btn-icon" id="audioToggleIcon">volume_up</span>
            </button>
        </div>
    </header>

    <main class="main-content" id="mainContent">
        <!-- Loading -->
        <div id="loadingState" class="loading-container">
            <div class="loading-dots">
                <span></span><span></span><span></span>
            </div>
            <p style="color: var(--muted);" id="loadingText">Loading stories...</p>
        </div>

        <!-- Story list -->
        <div id="storyListView" style="display: none;">
            <div
                style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 0 4px;">
                <span style="font-size:0.9rem; color: var(--muted);">Stories</span>
                <div style="display:flex; gap: 8px;">
                    <button id="youtubeLinkBtn"
                        style="display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--card-border); background:var(--card-bg); font-size:0.8rem; cursor:pointer; font-family:inherit; color:var(--muted);">
                        <span class="material-symbols-outlined" style="font-size:16px;">play_circle</span>
                        <span style="white-space:nowrap;">YouTube</span>
                    </button>
                    <label class="srt-upload-btn">
                        <span class="material-symbols-outlined" style="font-size:16px;">upload</span>
                        <span style="white-space: nowrap;">Use .srt subtitles</span>
                        <input type="file" id="srtFileInput" accept=".srt">
                    </label>
                </div>
            </div>
            <div id="storyList"></div>
        </div>

        <!-- Story reading view -->
        <div id="storyContent" style="display: none;">
            <div class="story-card" id="storyCard">
                <div class="story-header">
                    <div class="story-header-top">
                        <h1 class="story-title" id="storyTitle"></h1>
                        <div class="story-header-right">
                            <span class="story-level-badge" id="storyLevelBadge" style="display: none;"></span>
                        </div>
                    </div>
                    <p class="story-subtitle" id="storySubtitle"></p>
                </div>
                <div id="segmentsContainer"></div>
                <div class="tap-hint" id="tapHint">
                    <span class="material-symbols-outlined"
                        style="font-size: 16px; vertical-align: middle;">touch_app</span> Tap any word for meaning
                </div>
            </div>
        </div>

        <!-- Completed -->
        <div id="completedState" style="display: none;">
            <div class="completed-card">
                <div class="completed-emoji">ðŸŽ‰</div>
                <h2 class="completed-title">Story Complete!</h2>
                <p class="completed-subtitle">Great job reading the story!</p>
                <button class="continue-btn" id="restartBtn">Read Again</button>
                <button class="btn-secondary" id="backToListBtn">Back to Stories</button>
            </div>
        </div>
    </main>

    <!-- Continue -->
    <div class="continue-container" id="continueContainer" style="display: none;">
        <button class="continue-btn" id="continueBtn">Continue</button>
    </div>

    <!-- Action popup (delete) -->
    <div class="action-popup" id="actionPopup">
        <div class="action-popup__backdrop" id="actionPopupBackdrop"></div>
        <div class="action-popup__content">
            <div class="action-popup__header">
                <h3 class="action-popup__title" id="actionPopupTitle"></h3>
                <p class="action-popup__subtitle" id="actionPopupSubtitle"></p>
            </div>
            <div class="action-popup__actions">
                <button class="action-popup__btn action-popup__btn--danger" id="deleteStoryBtn">
                    <span class="material-symbols-outlined"
                        style="font-size: 18px; vertical-align: middle; margin-right: 8px;">delete</span>
                    Delete Story
                </button>
                <button class="action-popup__btn action-popup__btn--cancel" id="cancelActionBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Create story modal -->
    <div class="deck-modal" id="createModal">
        <div class="deck-modal__backdrop" id="createModalBackdrop"></div>
        <div class="deck-modal__content" style="border-radius: 20px; max-height: none;">
            <div class="deck-modal__header">
                <h3>Create New Story</h3>
                <button class="deck-modal__close" id="createModalClose">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div style="padding: 20px;">
                <!-- Tabs -->
                <div style="display:flex; gap:8px; margin-bottom:16px;">
                    <button id="tabAI" onclick="switchCreateTab('ai')"
                        style="flex:1; padding:8px; border-radius:10px; border:2px solid var(--accent); background:var(--accent); color:#fff; font-family:inherit; font-weight:600; cursor:pointer; font-size:0.85rem;">ðŸ¤–
                        AI Story</button>
                    <button id="tabText" onclick="switchCreateTab('text')"
                        style="flex:1; padding:8px; border-radius:10px; border:2px solid var(--card-border); background:var(--card-bg); color:var(--text); font-family:inherit; font-weight:600; cursor:pointer; font-size:0.85rem;">ðŸ“„
                        Paste Text</button>
                    <button id="tabYT" onclick="switchCreateTab('yt')"
                        style="flex:1; padding:8px; border-radius:10px; border:2px solid var(--card-border); background:var(--card-bg); color:var(--text); font-family:inherit; font-weight:600; cursor:pointer; font-size:0.85rem;">â–¶
                        YouTube</button>
                </div>

                <!-- Tab: AI -->
                <div id="tabContentAI">
                    <p style="color: var(--muted); font-size: 0.9rem; margin: 0 0 16px 0;">What kind of story would you
                        like to read?</p>
                    <input type="text" id="storyTopicInput"
                        placeholder="e.g., a trip to the airport, ordering food at a cafÃ©..."
                        style="width: 100%; padding: 14px 16px; border: 1px solid var(--card-border); border-radius: 12px; font-size: 1rem; font-family: inherit; outline: none; box-sizing: border-box;">
                    <div
                        style="margin-top: 12px; display: flex; gap: 8px; align-items: center; justify-content: space-between; flex-wrap: wrap;">
                        <label for="storyLevelSelect" style="font-size: 0.85rem; color: var(--muted);">German
                            level</label>
                        <select id="storyLevelSelect"
                            style="width: -webkit-fill-available; padding: 8px 12px; border-radius: 999px; border: 1px solid var(--card-border); font-size: 0.85rem; font-family: inherit; background: var(--card-bg);">
                            <option value="A1">A1 â€“ Beginner</option>
                            <option value="A2" selected>A2 â€“ Elementary</option>
                            <option value="B1">B1 â€“ Intermediate</option>
                            <option value="B2">B2 â€“ Upper-Intermediate</option>
                            <option value="C1">C1 â€“ Advanced</option>
                            <option value="C2">C2 â€“ Proficient</option>
                        </select>
                    </div>
                    <div style="margin-top: 16px; display: flex; gap: 12px;">
                        <button class="continue-btn" id="createStorySubmit" style="flex: 1; padding: 14px;">Create
                            Story</button>
                    </div>
                    <button id="randomStoryBtn"
                        style="width: 100%; margin-top: 12px; padding: 14px; border: 1px solid var(--card-border); background: var(--card-bg); color: var(--text); font-size: 1rem; font-weight: 600; border-radius: 12px; cursor: pointer; font-family: inherit; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span class="material-symbols-outlined" style="font-size: 20px;">shuffle</span>
                        Surprise Me!
                    </button>
                    <p style="color: var(--muted); font-size: 0.8rem; margin: 16px 0 0 0; text-align: center;">Stories
                        are generated using AI with German vocabulary</p>
                </div>

                <!-- Tab: Paste Text -->
                <div id="tabContentText" style="display:none;">
                    <p style="color: var(--muted); font-size: 0.9rem; margin: 0 0 12px 0;">Paste your German text below
                        â€” each line becomes a segment.</p>
                    <textarea id="storyTextInput" placeholder="Paste your German story or subtitle text here..."
                        style="width: 100%; min-height: 120px; padding: 12px 14px; border: 1px solid var(--card-border); border-radius: 12px; font-size: 0.95rem; font-family: inherit; outline: none; resize: vertical; box-sizing: border-box;"></textarea>
                    <div
                        style="margin-top: 12px; display: flex; gap: 8px; align-items: center; justify-content: space-between; flex-wrap: wrap;">
                        <label style="font-size: 0.85rem; color: var(--muted);">German level</label>
                        <select id="textLevelSelect"
                            style="width: -webkit-fill-available; padding: 8px 12px; border-radius: 999px; border: 1px solid var(--card-border); font-size: 0.85rem; font-family: inherit; background: var(--card-bg);">
                            <option value="A1">A1 â€“ Beginner</option>
                            <option value="A2" selected>A2 â€“ Elementary</option>
                            <option value="B1">B1 â€“ Intermediate</option>
                            <option value="B2">B2 â€“ Upper-Intermediate</option>
                            <option value="C1">C1 â€“ Advanced</option>
                            <option value="C2">C2 â€“ Proficient</option>
                        </select>
                    </div>
                    <button class="continue-btn" id="submitTextStoryBtn"
                        style="width:100%; margin-top:16px; padding:14px;">Process Text</button>
                </div>

                <!-- Tab: YouTube -->
                <div id="tabContentYT" style="display:none;">
                    <p style="color: var(--muted); font-size: 0.9rem; margin: 0 0 12px 0;">
                        Paste a YouTube link to a German video. We'll extract the subtitles and translate them line by
                        line.
                    </p>
                    <input type="url" id="ytUrlInput" placeholder="https://www.youtube.com/watch?v=..."
                        style="width:100%; padding:14px 16px; border:1px solid var(--card-border); border-radius:12px; font-size:1rem; font-family:inherit; outline:none; box-sizing:border-box;">
                    <div
                        style="margin-top: 12px; display: flex; gap: 8px; align-items: center; justify-content: space-between; flex-wrap: wrap;">
                        <label style="font-size: 0.85rem; color: var(--muted);">German level</label>
                        <select id="ytLevelSelect"
                            style="width: -webkit-fill-available; padding: 8px 12px; border-radius: 999px; border: 1px solid var(--card-border); font-size: 0.85rem; font-family: inherit; background: var(--card-bg);">
                            <option value="A1">A1 â€“ Beginner</option>
                            <option value="A2" selected>A2 â€“ Elementary</option>
                            <option value="B1">B1 â€“ Intermediate</option>
                            <option value="B2">B2 â€“ Upper-Intermediate</option>
                            <option value="C1">C1 â€“ Advanced</option>
                            <option value="C2">C2 â€“ Proficient</option>
                        </select>
                    </div>
                    <button class="continue-btn" id="submitYTBtn" style="width:100%; margin-top:16px; padding:14px;">
                        <span class="material-symbols-outlined"
                            style="font-size:20px; vertical-align:middle; margin-right:6px;">play_circle</span>
                        Extract &amp; Translate
                    </button>
                    <p id="ytError" style="color:var(--danger); font-size:0.85rem; margin:10px 0 0 0; display:none;">
                    </p>
                    <p style="color: var(--muted); font-size: 0.75rem; margin: 12px 0 0 0; text-align: center;">Requires
                        German subtitles (manual or auto-generated) on the video</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/story.js"></script>
</body>

</html>